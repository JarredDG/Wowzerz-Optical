<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="delivery.css">
</head>
<body>
  
<div class="froggers">
  <div class="nav"><a href="home.html"><h1>HOME</h1></a></div>
  <div class="nav"><a href="details.html"><h1>DETAILS</h1></a></div>
  <div class="nav">
    <div class="dropdown">
      <h1>EYEWEAR â–¼</h1>
      <div class="dropdown-content">
        <a href="Eyeglasses-men.html">Men</a>
        <a href="Eyeglasses-womens.html">Women</a>
        <a href="Eyeglasses-kids.html">Kids</a>
        <a href="Eyeglasses-unisex.html">Unisex</a>
      </div>
    </div>
  </div>
  <div class="nav"><a href="contacts.html"><h1>CONTACT US</h1></a></div>
  <div class="nav"><a href="About-us.html"><h1>ABOUT US</h1></a></div>
  <div class="cart-btn"><a href="cart.html">ðŸ›’</a></div>
</div>
 
<div class="container">
  <h2>Details for Delivery:</h2>

  <form id="delivery-form">
    <div style="margin-bottom:15px;">
      <label>Customer Name:</label>
      <input type="text" id="custName" placeholder="Enter your name" required>
    </div>

    <div style="margin-bottom:15px;">	
      <label>Mobile Number:</label>
      <input type="text" id="custNumber" placeholder="Enter your mobile number" required>
    </div>

    <div style="margin-bottom:10px;">	
      <label>Address:</label>
      <input type="text" id="custAddress" placeholder="Address" required>
    </div>

    <div style="margin-bottom:15px;">
      <label>Payment Method:</label>
      <select id="paymentMethod" required>
        <option value="">-- Select Payment Method --</option>
        <option value="Cash on Delivery">Cash on Delivery</option>
        <option value="GCash">GCash</option>
      </select>
    </div>

    <div style="margin-bottom:15px;" id="cashAmountDiv";>
      <label>Amount Youâ€™ll Pay:</label>
      <input type="number" id="custCash" placeholder="Enter amount youâ€™ll pay" min="0" step="0.01">
    </div>

 <div style="margin-bottom:15px;">
  <label><input type="checkbox" id="seniorPWD"> Senior / PWD Discount (20%)</label>
</div>

    <div class="button">
      <button type="submit">CONFIRM ORDER</button>
    </div>
  </form>
</div>

<script>
document.getElementById('paymentMethod').addEventListener('change', function() {
  const cashField = document.getElementById('cashAmountDiv');
  if (this.value === 'Cash on Delivery') {
    cashField.style.display = 'block';
  } else {
    cashField.style.display = 'none';
    document.getElementById('custCash').value = '';
  }
});

document.getElementById('delivery-form').addEventListener('submit', function(e) {
  e.preventDefault();

  const cart = JSON.parse(localStorage.getItem('cart')) || [];
  let total = 0;
  cart.forEach(item => {
    const price = parseFloat(item.price.replace(/[â‚±,]/g, ""));
    total += price * item.quantity;
  });

  const paymentMethod = document.getElementById('paymentMethod').value;
  const cashAmount = parseFloat(document.getElementById('custCash').value) || 0;

  const discountChecked = document.getElementById('seniorPWD').checked;
  let discountAmount = 0;
  if (discountChecked) {
    discountAmount = total * 0.20;
  }

const finalTotal = total - discountAmount;

  if (paymentMethod === 'Cash on Delivery') {
    if (isNaN(cashAmount) || cashAmount < finalTotal) {
      alert(`The amount you entered (â‚±${cashAmount.toLocaleString()}) is less than your total payable amount of â‚±${finalTotal.toLocaleString()}.\n\nPlease enter a valid amount.`);
      return;
    }
  }

  const customer = {
    name: document.getElementById('custName').value,
    number: document.getElementById('custNumber').value,
    address: document.getElementById('custAddress').value,
    payment: paymentMethod,
    cashAmount: cashAmount,
    totalAmount: total,
    discountApplied: discountAmount,
    finalTotal: finalTotal,
    change: cashAmount - finalTotal
  };

  localStorage.setItem('customerDetails', JSON.stringify(customer));

let products = JSON.parse(localStorage.getItem('products')) || [];
  cart.forEach(item => {
    const product = products.find(p => p.id === item.id);
    if (product) {
      product.stock -= item.quantity;
      if (product.stock < 0) product.stock = 0; // prevent negative stock
    }
  });
  localStorage.setItem('products', JSON.stringify(products))

  localStorage.removeItem('cart');

  window.location.href = "RESIBOHAHA.html";
});
</script>
</body>
</html>
